SNS("SNS.widget.Feed",function(){var a=KISSY,e=a.DOM,d=a.Event,f=a.JSON,c=SNS.sys.Helper;var b=function(g){b.superclass.constructor.call(this,g)};b.ATTRS={rootNode:{value:"#J_FeedsContainer"},paramGetFeed:{value:{page:1}}};b.EVENTS={click:{".icon-del-simple":"delFeedEvent",".J_DeleteMB":"delJiwaiFeedEvent",".icon-filter-simple":"filterFeedEvent",".J_viewMoreFresh":"loadMoreFeedEvent",".small-img":"zoomOutEvent",".J_ZoomInImg":"zoomInEvent",".big-img":"zoomInEvent",".J_FeedTab,.J_MoreTab":"feedTabEvent",".J_Share":"shareEvent",".J_Reply":"cmtEvent",".J_Forward":"forwardEvent",".sns-linkcheck":"checkLinkEvent",".more-share":"showMoreShareEvent"},mouseenter:{".short-url":function(h,g){SNS.widget.ShortLink.show(h,g)}},mouseleave:{".short-url":function(h,g){SNS.widget.ShortLink.hide(h,g)}}};b.DOMS={item:{parent:".item"}};b.AOPS={before:{"*Event":"preventDefault",delJiwaiFeedEvent:"checkLogin"}};SNS.Base.extend(b,SNS.data.Feed,{init:function(){this.fixedHover(this.get("rootNode"));return this},scrollLoadFeed:function(g){var h=this,l="getFeed",i=this.getData(l);g=g||{};var k=a.merge(this.get("paramGetFeed"),g.param||{});var j=new SNS.util.ScrollLoad({url:g.url||i.url,param:k,el:g.el||e.get(h.get("rootNode")),success:function(m,o,n){if(g.success){g.success(m,o,n)}h.fixedHover(n)}}).init();return j},loadFeed:function(g){var h=this,l="getFeed",k=this.getData(l);var n={};var j=g.el||e.get(h.get("rootNode"));var i=g.url||k.url;var m=document.createElement("div");m.innerHTML="<img src='http://img06.taobaocdn.com/tps/i6/T13l0vXhRrXXXXXXXX-24-24.gif' alt='loading ...' /><br /><br />";j.appendChild(m);n.data=a.merge(this.get("paramGetFeed"),g.param||{page:1});n.success=function(o){m.style.display="none";e.remove(m);j.innerHTML=o.responseText;if(g.success){g.success(o.responseText)}};SNS.request(i,n)},loadMoreFeedEvent:function(k,i){var l=e.attr(i,"data-param");if(!l){return}var h=this;var j=e.get(h.get("rootNode"));var m=document.createElement("div");m.innerHTML="<img src='http://img06.taobaocdn.com/tps/i6/T13l0vXhRrXXXXXXXX-24-24.gif' alt='loading ...' /><br /><br />";j.appendChild(m);l=a.JSON.parse(l);var g={data:l,success:function(n){m.style.display="none";e.remove(m);j.innerHTML+=n.responseText}};e.remove(i);SNS.request(i.href,g)},delFeedEvent:function(i,g){var h=this.getDOM("item",g);this.simpleLoadData("delFeed",function(){e.remove(h)},h,g)},delJiwaiFeedEvent:function(m,k){var n="delJiwaiFeed",i=this,h,l=this.getDOM("item",k),j,g;j=function(){if(h){h.hide()}i.simpleLoadData(n,function(){e.remove(l)},l,k)},g=e.attr("data-txt",k)||"\u60a8\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u53fd\u6b6a\u5417?";h=c.showConfirm(g,j)},filterFeedEvent:function(m,k){m.preventDefault();var n="filterFeed",i=this,h,l=this.getDOM("item",k),j=function(){if(h){h.hide()}i.simpleLoadData(n,function(){e.remove(l)},k)},g=e.attr("data-txt",k)||"\u4ee5\u540e\u4e0d\u518d\u63a5\u6536<span>\u8fd9\u4e2a\u597d\u53cb\u7684\u8be5\u7c7b\u578b</span>\u52a8\u6001\uff0c\u4f60\u786e\u8ba4\u5417?(\u4f60\u53ef\u4ee5\u5728\u9690\u79c1\u8bbe\u7f6e\u91cc\u89e3\u9664\u6b64\u5c4f\u853d)?";h=c.showConfirm(g,j)},shareEvent:function(i,h){var g=e.parent(h),j=f.parse(e.attr("data-param",g));SNS.widget.Share.shareSub(j)},zoomOutEvent:function(n,k){n.preventDefault();var h=this,l=e.parent(k,".item"),m=e.get("img.small-img",l),i=e.get("img.big-img",l),j=e.get("a.toggle",l);e.addClass(j,"J_ZoomInImg");j.innerHTML="\u6536\u8d77";var g=j.parentNode;i.onload=function(){setTimeout(function(){m.style.display="none";i.style.display="block";h.resize(i,450,1500);e.removeClass(g,"hidden");var o=YAHOO.util.Dom.getNextSibling(l);o&&c.doReflow(o)},50)};i.src=m.getAttribute("data-src")},zoomInEvent:function(k,n){k.preventDefault();var o=this,m=e.parent(n,".item"),h=e.get("img.small-img",m),j=e.get("img.big-img",m),g=e.get("a.toggle",m);var l=g.parentNode;h.style.display="block";j.style.display="none";e.addClass(l,"hidden");var i=YAHOO.util.Dom.getNextSibling(m);i&&c.doReflow(i)},cmtEvent:function(l,i){l.preventDefault();var k=e.parent(i,".item"),j=e.get(".fd-reply",k),h=this,g;if(i._status==1){j.innerHTML="";e.addClass(j,"hidden");i._status=0;return}i._status=1;e.removeClass(j,"hidden");if(i._c){i._c.init()}else{g=f.parse(e.attr(i,"data-cfg"));g.rootNode=j;a.mix(g,h.get("commentCallback"));i._c=new SNS.widget.Comment(g);i._c.init()}return i._c},forwardEvent:function(j,i){j.preventDefault();var h=this,g;g=f.parse(e.attr(i,"data-cfg"));return new SNS.widget.Forward(g).init()},resize:function(i,g,j){var l=g/j;var k=i.width/i.height;if(k>=l&&i.width>g){i.width=g;i.height=i.width/k}else{if(k<l&&i.height>j){i.height=j;i.width=i.height*k}}},checkLogin:function(h){var g=function(){};if(!c.checkAndShowLogin({callback:g})){h.halt()}},checkLinkEvent:function(h,g){new SNS.sys.LinkCheck(g).check()},toggleClass:function(h,g){e.toggleClass(g,"hover")},preventDefault:function(g){KISSY.log("preventDefault");KISSY.log(g&&g.arguments&&g.arguments[0]);KISSY.log(g.arguments[0].preventDefault);if(g&&g.arguments&&g.arguments[0]){g.arguments[0].preventDefault()}},fixedHover:function(g){var h=e.query(".item",g);d.on(h,"mouseenter",function(i){e.addClass(i.currentTarget,"hover")});d.on(h,"mouseleave",function(i){e.removeClass(i.currentTarget,"hover")})},showMoreShareEvent:function(h,g){if(g._status==1){return}g._status=1;var i=e.attr(g,"data-param");if(i){i=a.JSON.parse(i)}this.loadData("moreShare",function(k){var j=SNS.sys.snsNearbyPanel(g,k.result.html,{width:"400px",offsetTop:"-50px",offsetLeft:"80px",hideHandle:true,onShow:function(){if(a.get("span",g)){a.get("span",g).className="fd-open"}},onHide:function(){if(a.get("span",g)){a.get("span",g).className="fd-close"}}}).show()},i)}});SNS.widget.Feed=b},"SNS.data.Feed,SNS.widget.ShortLink,SNS.util.ScrollLoad,SNS.widget.Comment");
